module.exports=function(t){function n(o){if(r[o])return r[o].exports;var e=r[o]={exports:{},id:o,loaded:!1};return t[o].call(e.exports,e,e.exports,n),e.loaded=!0,e.exports}var r={};return n.m=t,n.c=r,n.p="",n(0)}([function(t,n,r){"use strict";var o=r(1);n.createClient=o.createClient},function(t,n,r){"use strict";function o(t){void 0===t&&(t={});var n="number"==typeof t?{port:t}:t,r={host:n.host||"127.0.0.1",port:n.port||8080,serializer:n.serializer||new c.Msgpack},o={transport:new f(r),backoff:n.backoff||new p.BackoffExponential,queue:n.queue||1e3};return new h.Client(o)}var e=this&&this.__extends||function(t,n){function r(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},i=r(2),s=r(3),u=r(4),a=r(6),h=r(7),c=r(12),p=r(14),f=function(t){function n(r){void 0===r&&(r={}),t.call(this,i.extend({},n.defaults,r))}return e(n,t),n.prototype.createStreams=function(){var t=this;this.socket=new a.Socket,this.out=new u.LPEncoderStream,this["in"]=new u.LPDecoderStream,this.out.on("error",function(n){t.onerror(n)}),this["in"].on("error",function(n){t.onerror(n)})},n.prototype.start=function(t,n){var r=this;this.createStreams(),this.out.pipe(this.socket),this.socket.pipe(this["in"]),this["in"].on("data",this.onMessage.bind(this)),this.socket.on("error",function(t){r.onerror(t),n()}).on("close",function(){r.onstop()}).connect(this.opts.port,this.opts.host,function(){r.onstart(),t()})},n.prototype.stop=function(){this.socket.end()},n.prototype.onMessage=function(t){var n=this.unserialize(t);this.onmessage(n)},n.prototype.send=function(t){var n=this.serialize(t);try{this.out.write(n)}catch(r){this.onerror(r)}},n.defaults={host:"127.0.0.1",port:8080,serializer:null},n}(s.ClientTransport);n.ClientTransportTcp=f,n.createClient=o},function(t,n){"use strict";function r(t,n){for(var o=[],e=2;e<arguments.length;e++)o[e-2]=arguments[e];if("object"==typeof n)for(var i in n)t[i]=n[i];return o.length?r.apply(null,[t].concat(o)):t}function o(){}n.extend=r,n.noop=o},function(t,n,r){"use strict";var o=this&&this.__extends||function(t,n){function r(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},e=r(2),i=function(){function t(){this.onmessage=e.noop}return t}();n.Connection=i;var s=function(){function t(t){this.opts={serializer:null},this.onconnection=e.noop,this.onstart=e.noop,this.onstop=e.noop,this.onerror=e.noop,this.opts=e.extend(this.opts,t)}return t.prototype.createConncetion=function(){var t=new this.ClassConnection;return t.transport=this,t.serializer=this.opts.serializer,t},t.prototype.serialize=function(t){return this.opts.serializer.pack(t)},t.prototype.unserialize=function(t){return this.opts.serializer.unpack(t)},t}();n.Transport=s;var u=function(t){function n(){t.apply(this,arguments),this.onmessage=e.noop}return o(n,t),n}(s);n.ClientTransport=u},function(t,n,r){"use strict";var o=this&&this.__extends||function(t,n){function r(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},e=r(5),i=function(){function t(){}return t.prototype.encode=function(t){var n=new Buffer(4);return n.writeInt32BE(t.length,0),Buffer.concat([n,t])},t}();n.LPEncoder=i;var s=function(){function t(){this.buf=new Buffer("")}return t.prototype.add=function(t){return this.buf=Buffer.concat([this.buf,t]),this},t.prototype.shift=function(){if(this.buf.length<5)return null;var t=this.buf.readInt32BE(0);if(this.buf.length>t){var n=this.buf.slice(4,t+4);return this.buf=this.buf.slice(t+4),n}return null},t}();n.LPDecoder=s;var u=function(t){function n(n){t.call(this),this.encoder=new i,n&&this.pipe(n)}return o(n,t),n.prototype._transform=function(t,n,r){var o=t;"string"==typeof t&&(o=new Buffer(t,n));var e=this.encoder.encode(o);r(null,e)},n}(e.Transform);n.LPEncoderStream=u;var a=function(t){function n(n){t.call(this),this.decoder=new s,n&&n.pipe(this)}return o(n,t),n.prototype._transform=function(t,n,r){var o=t;"string"==typeof t&&(o=new Buffer(t,n)),this.decoder.add(o);for(var e;e=this.decoder.shift();)this.push(e);r()},n}(e.Transform);n.LPDecoderStream=a;var h=function(t){function n(){t.call(this)}return o(n,t),n.prototype._transform=function(t,n,r){r()},n}(e.Transform);n.Buffered=h},function(t,n){t.exports=require("stream")},function(t,n){t.exports=require("net")},function(t,n,r){"use strict";var o=this&&this.__extends||function(t,n){function r(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},e=r(2),i=r(8),s=r(9),u=r(11),a=function(t){function n(n){var r=this;void 0===n&&(n={}),t.call(this,n),this.router=new s.Router,this.onmessage=e.noop,this.queue=new u.Queue(n.queue),this.opts.transport.onmessage=function(t){r.onmessage(t),r.router.onmessage(t)},this.router.send=this.send.bind(this)}return o(n,t),n.prototype.onStart=function(){t.prototype.onStart.call(this),this.drainQueue()},n.prototype.drainQueue=function(){for(var t,n=this.opts.transport;t=this.queue.shift();)n.send(t)},n.prototype.send=function(t){return this.isStarted?this.opts.transport.send(t):this.queue.add(t),this},n}(i.Server);n.Client=a},function(t,n,r){"use strict";var o=r(2),e=r(9),i=function(){function t(t){var n=this;this.router=new e.Router,this.onmessage=o.noop,this.connection=t,this.connection.onmessage=function(t){n.onmessage(t,n),n.router.onmessage(t)},this.router.send=this.send.bind(this)}return t.prototype.send=function(t){return this.connection.send(t),this},t}();n.Socket=i;var s=function(){function t(t){void 0===t&&(t={}),this.opts={},this.isStarted=!1,this.api=new e.Api,this.onsocket=o.noop,this.onstart=o.noop,this.onstop=o.noop,this.onerror=o.noop,this.opts=o.extend(this.opts,t)}return t.prototype.createSocket=function(t){var n=new i(t);return n.router.setApi(this.api),n},t.prototype.onStart=function(){this.isStarted=!0,this.onstart()},t.prototype.onStop=function(){this.isStarted=!1,this.onstop()},t.prototype.onError=function(t){this.onerror(t)},t.prototype.onConnection=function(t){this.onsocket(this.createSocket(t))},t.prototype.tryStart=function(t,n){var r=this.opts.transport;r.onconnection=this.onConnection.bind(this),r.onstart=this.onStart.bind(this),r.onstop=this.onStop.bind(this),r.onerror=this.onError.bind(this),r.start(t,n)},t.prototype.start=function(){return this.opts.backoff.attempt(this.tryStart.bind(this)),this},t.prototype.stop=function(){return this.opts.transport.stop(),this},t}();n.Server=s},function(t,n,r){"use strict";var o=this&&this.__extends||function(t,n){function r(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},e=r(10),i=function(){function t(){this.data=null,this.id=0,this.event="",this.args=[],this.callbacks=[],this.rid=0,this.func=0,this.timeout=t.timeout}return t.getNextId=function(){return t.id=t.id%1e9+1},t.prototype.hasCallbacks=function(){for(var t=0,n=this.args;t<n.length;t++){var r=n[t];if("function"==typeof r)return!0}return!1},t.prototype.isResponse=function(){return!!this.rid},t.id=0,t.timeout=5e3,t}();n.Frame=i;var s=function(t){function n(n,r){void 0===n&&(n=[]),void 0===r&&(r=""),t.call(this),this.id=i.getNextId(),this.event=r,this.args=n}return o(n,t),n.createResponse=function(t,r,o){var e=new n(o);return e.rid=t.id,e.func=r,e},n.prototype.processResponse=function(t){var n=t.func,r=this.args[n];"function"==typeof r&&(this.args[n]=null,r.apply(null,t.args))},n.prototype.serialize=function(){var t={i:this.id,e:this.event};if(this.args.length){t.a=[];for(var n=[],r=0;r<this.args.length;r++){var o=this.args[r];"function"==typeof o?(n.push(r),this.callbacks.push(o)):(t.a.push(o),i.timeout!=this.timeout&&(t.t=this.timeout/1e3))}n.length&&(t.c=n)}return this.rid&&(t.r=this.rid,t.f=this.func),this.data=t,this.data},n}(i);n.FrameOutgoing=s;var u=function(t){function n(){t.apply(this,arguments)}return o(n,t),n.prototype.unserialize=function(t,n){if(this.data=t,"number"!=typeof t.i)throw Error("Error parsing id");if(this.id=t.i,t.t){if("number"!=typeof t.t)throw Error("Error parsing timeout");this.timeout=t.t}else this.timeout=i.timeout;if(this.args=[],t.a){if(!(t.a instanceof Array))throw Error("Error parsing arguments");for(var r=0,o=t.a;r<o.length;r++){var e=o[r];this.args.push(e)}}else t.a=[];if(this.callbacks=[],t.c){if(!(t.c instanceof Array))throw Error("Error parsing callbacks");for(var s=0,u=t.c;s<u.length;s++){var a=u[s],h=n(this,a);this.callbacks.push(h),this.args.splice(a,0,h)}}if(this.event="",this.rid=0,this.func=0,t.e){if("string"!=typeof t.e)throw Error("Error parsing event");this.event=t.e}else if(t.r){if("number"!=typeof t.r)throw Error("Error parsing resposne id");if(this.rid=t.r,"number"!=typeof t.f)throw Error("Error parsing reponse position");this.func=t.f}},n}(i);n.FrameIncoming=u;var a=function(){function t(){this.latency=500,this.frame={},this.timer={},this.onerror=function(){},this.api=null,this.subs={}}return t.prototype.genCallack=function(t,n){var r=this,o=!1;return function(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];if(o)throw Error('Already called: .on("'+t.event+'") '+n+"th arg");o=!0,r.dispatch(s.createResponse(t,n,e))}},t.prototype.pub=function(t){var n=t.event,r=t.args;if(n){this.onevent&&this.onevent(n,r);var o;if(this.api&&(o=this.api.get(n)),o)o.apply(this,r);else{var e=this.subs[n];e&&e.apply(null,r),e=this.subs["*"],e&&e.apply(null,[n].concat(r))}}},t.prototype.sendData=function(t){this.send(t)},t.prototype.dispatch=function(t){var n=this;t.hasCallbacks()&&(this.frame[t.id]=t,this.timer[t.id]=setTimeout(function(){delete n.frame[t.id]},t.timeout+this.latency));var r=t.serialize();this.sendData(r)},t.prototype.processResponse=function(t){var n=this.frame[t.rid];if(n&&(n.processResponse(t),!n.hasCallbacks())){var r=n.id;delete this.frame[r];var o=this.timer[r];o&&clearTimeout(o),delete this.timer[r]}},t.prototype.setApi=function(t){return this.api=t,this},t.prototype.onmessage=function(t){var n=new u;try{n.unserialize(t,this.genCallack.bind(this))}catch(r){return void this.onerror(r)}n.isResponse()?this.processResponse(n):this.pub(n)},t.prototype.on=function(t,n){return this.subs[t]=n,this},t.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=new s(n,t);return this.dispatch(o),this},t}();n.Router=a;var h=function(t){function n(){t.apply(this,arguments),this.cycle=10,this.timer=0,this.buffer=[]}return o(n,t),n.prototype.flush=function(){this.send(this.buffer),this.buffer=[]},n.prototype.sendData=function(t){this.buffer.push(t),this.startTimer()},n.prototype.startTimer=function(){var t=this;this.timer||(this.timer=setTimeout(function(){t.timer=0,t.flush()},this.cycle))},n.prototype.onmessage=function(n){if("object"==typeof n)if(n instanceof Array)for(var r=0,o=n;r<o.length;r++){var e=o[r];t.prototype.onmessage.call(this,e)}else t.prototype.onmessage.call(this,n)},n}(a);n.RouterBuffered=h;var c=function(){function t(){this.methods={}}return t.prototype.add=function(t){return this.methods=e.extend(this.methods,t),this},t.prototype.get=function(t){return this.methods[t]},t}();n.Api=c},function(t,n){"use strict";function r(t,n){for(var o=[],e=2;e<arguments.length;e++)o[e-2]=arguments[e];if("object"==typeof n)for(var i in n)t[i]=n[i];return o.length?r.apply(null,[t].concat(o)):t}n.extend=r},function(t,n){"use strict";var r=function(){function t(t){void 0===t&&(t=1e3),this.data=[],this.max=t}return t.prototype.add=function(t){this.data.push(t),this.data.length>this.max&&this.shift()},t.prototype.shift=function(){return this.data.shift()},t}();n.Queue=r},function(t,n,r){"use strict";var o=function(){function t(){}return t.prototype.pack=function(t){var n=r(13);return n.encode(t)},t.prototype.unpack=function(t){var n=r(13);return n.decode(t)},t}();n.Msgpack=o},function(t,n){t.exports=require("msgpack-lite")},function(t,n){"use strict";var r=this&&this.__extends||function(t,n){function r(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},o=function(){function t(){this.retryCount=0}return t.prototype.onSuccess=function(){this.retryCount=0},t.prototype.retry=function(){this.retryCount++,this.operation(this.onSuccess.bind(this),this.onError.bind(this))},t.prototype.attempt=function(t){this.operation=t,this.retry()},t}();n.Backoff=o;var e=function(t){function n(n){void 0===n&&(n=3),t.call(this),this.maxRetries=3,this.maxRetries=n}return r(n,t),n.prototype.onError=function(t){this.retryCount<this.maxRetries&&this.retry()},n}(o);n.BackoffRetry=e;var i=function(t){function n(){t.apply(this,arguments),this.minTimeout=1e3,this.base=2,this.maxTimeout=36e5}return r(n,t),n.prototype.onError=function(t){var n=this.minTimeout*Math.pow(this.base,this.retryCount-1);n<this.maxTimeout&&setTimeout(this.retry.bind(this),n)},n}(o);n.BackoffExponential=i}]);